<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Partycrasher App</title>
    <style>
        :root {
            --primary-color: #e8495f; /* Partycrasher Pink */
            --secondary-color: #075e54; /* Mitarbeiter Grün */
            --light-gray: #f4f7f6;
            --dark-gray: #333;
            --white: #fff;
        }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; margin: 0; background-color: var(--light-gray); color: var(--dark-gray); }
        .container { max-width: 900px; margin: 20px auto; padding: 0 20px; }
        .view { display: none; } /* Alle Ansichten standardmäßig ausblenden */
        .view.active { display: block; } /* Nur die aktive Ansicht zeigen */
        .card { background-color: var(--white); border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); margin-bottom: 20px; padding: 20px; }
        h1, h2 { margin-top: 0; }
        h1 { color: var(--primary-color); }
        h2 { color: var(--dark-gray); border-bottom: 2px solid var(--light-gray); padding-bottom: 10px; }
        
        /* Login-Ansicht */
        #login-view .card { max-width: 400px; margin: 50px auto; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: bold; }
        .form-group input { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
        .btn { display: inline-block; color: var(--white); padding: 12px 20px; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; text-align: center; text-decoration: none; width: 100%; box-sizing: border-box; margin-top: 10px; }
        .btn-admin { background-color: var(--primary-color); }
        .btn-admin:hover { background-color: #d13047; }
        .btn-employee { background-color: var(--secondary-color); }
        .btn-employee:hover { background-color: #054e46; }

        /* Admin-Ansicht */
        .product-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 15px; margin-bottom: 30px; }
        .product-card { border: 1px solid #ddd; border-radius: 8px; padding: 15px; cursor: pointer; transition: all 0.2s ease-in-out; }
        .product-card:hover { border-color: var(--primary-color); background-color: #fff8f9; }
        .product-card.selected { border-color: var(--primary-color); background-color: #fcdde2; border-width: 2px; }
        .product-card h3 { margin-top: 0; }
        .product-card p { font-size: 0.9em; color: #666; }
        #whatsapp-link-container { margin-top: 20px; padding: 15px; background-color: #e8f5e9; border: 1px solid #a5d6a7; border-radius: 5px; display: none; }
        
        /* Mitarbeiter-Ansicht */
        .booking-list-item { border-left: 5px solid var(--secondary-color); padding: 20px; }
        .booking-list-item h3 { margin-top: 0; }
        .booking-list-item p { margin: 5px 0; }
        .booking-list-item ul { padding-left: 20px; margin-top: 10px; }
        .booking-header { display: flex; justify-content: space-between; align-items: center; }
        .btn-delete { background-color: #aaa; width: auto; padding: 5px 10px; font-size: 12px; }
        .btn-logout { background-color: #6c757d; }

        /* Header */
        header { background-color: var(--white); padding: 10px 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center; }
        header h1 { font-size: 24px; margin: 0; }
    </style>
</head>
<body>

    <div id="login-view" class="view active">
        <div class="container">
            <div class="card">
                <h1>Willkommen!</h1>
                <p>Bitte wählen Sie Ihre Rolle.</p>
                <div class="form-group">
                    <label for="password">Admin-Passwort</label>
                    <input type="password" id="password" placeholder="Passwort eingeben">
                </div>
                <button id="admin-login-btn" class="btn btn-admin">Als Admin anmelden</button>
                <hr style="margin: 20px 0; border: 1px solid var(--light-gray);">
                <button id="employee-login-btn" class="btn btn-employee">Als Mitarbeiter fortfahren</button>
            </div>
        </div>
    </div>
    
    <header id="app-header" style="display: none;">
        <h1 id="header-title"></h1>
        <button id="logout-btn" class="btn btn-logout" style="width: auto;">Abmelden</button>
    </header>

    <div id="admin-view" class="view">
        <div class="container">
            <div class="card">
                <h2>1. Produkte auswählen</h2>
                <div id="product-grid" class="product-grid"></div>
            </div>
            <div class="card">
                <h2>2. Kundendaten & Details</h2>
                <form id="booking-form">
                    <div class="form-group"><label for="customerName">Kundenname</label><input type="text" id="customerName" required></div>
                    <div class="form-group"><label for="customerPhone">Kunden-Telefon</label><input type="tel" id="customerPhone" required></div>
                    <div class="form-group"><label for="deliveryAddress">Lieferadresse</label><textarea id="deliveryAddress" rows="3" required></textarea></div>
                    <div class="form-group"><label for="deliveryDate">Lieferdatum</label><input type="date" id="deliveryDate" required></div>
                    <div class="form-group"><label for="deliveryTime">Lieferzeit</label><input type="time" id="deliveryTime" required></div>
                    <div class="form-group"><label for="notes">Anmerkungen</label><textarea id="notes" rows="3"></textarea></div>
                    <button type="submit" class="btn btn-admin">Buchung für Mitarbeiter speichern</button>
                </form>
                <div id="whatsapp-link-container">
                    <p>Buchung wurde gespeichert! Optional können Sie die Daten auch via WhatsApp teilen:</p>
                    <a id="whatsapp-link" href="#" target="_blank" class="btn" style="background-color: #25d366;">Auf WhatsApp teilen</a>
                </div>
            </div>
        </div>
    </div>

    <div id="employee-view" class="view">
        <div class="container">
            <div class="card">
                <h2>Offene Aufträge</h2>
                <div id="bookings-list">
                    <p>Keine Aufträge vorhanden.</p>
                </div>
            </div>
        </div>
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    // --- KONFIGURATION ---
    const ADMIN_PASSWORD = "1234"; // !! WICHTIG: Ändern Sie dieses Passwort!
    const products = [
        { id: 1, category: 'Hüpfburgen', name: 'Multiplay Super (mit Rutsche)' }, { id: 2, category: 'Hüpfburgen', name: 'Multiplay Einhorn (mit Rutsche)' }, { id: 3, category: 'Hüpfburgen', name: 'Multiplay Feuerwehr (mit Rutsche)' }, { id: 4, category: 'Hüpfburgen', name: 'Multiplay Clown (mit Rutsche)' }, { id: 5, category: 'Hüpfburgen', name: 'Multiplay Dschungel (mit Rutsche)' }, { id: 6, category: 'Hüpfburgen', name: 'Profi Parkour (Hindernisbahn)' }, { id: 7, category: 'Eventmodule & Fun Food', name: 'Slush-Eis-Maschine' }, { id: 8, category: 'Eventmodule & Fun Food', name: 'Popcornmaschine' }, { id: 9, category: 'Eventmodule & Fun Food', name: 'Zuckerwattemaschine' }, { id: 10, category: 'Zelte & Mobiliar', name: 'Partyzelt 4x8 Meter' }, { id: 11, category: 'Zelte & Mobiliar', name: 'Stehtisch' }, { id: 12, category: 'Zelte & Mobiliar', name: 'Bierzeltgarnitur' }, { id: 13, category: 'Zelte & Mobiliar', name: 'Theke' }, { id: 14, category: 'Zelte & Mobiliar', name: 'Kühlschrank' }, { id: 15, category: 'Zubehör', name: 'Stromgenerator' }, { id: 16, category: 'Zubehör', name: 'Nebelmaschine' }, { id: 17, category: 'Zubehör', name: 'Lichterkette' }, { id: 18, category: 'Zubehör', name: 'Musikbox (Teufel Rockster Air)' }
    ];

    // --- DOM-Elemente ---
    const views = document.querySelectorAll('.view');
    const loginView = document.getElementById('login-view');
    const adminView = document.getElementById('admin-view');
    const employeeView = document.getElementById('employee-view');
    const appHeader = document.getElementById('app-header');
    const headerTitle = document.getElementById('header-title');
    
    // --- Se ssions-Management ---
    function switchView(viewId) {
        views.forEach(v => v.classList.remove('active'));
        document.getElementById(viewId).classList.add('active');
        
        const isLoggedIn = viewId !== 'login-view';
        appHeader.style.display = isLoggedIn ? 'flex' : 'none';

        if (isLoggedIn) {
            headerTitle.textContent = viewId === 'admin-view' ? 'Admin Dashboard' : 'Mitarbeiter-Aufträge';
        }
    }

    // Beim Laden der Seite prüfen, ob bereits eine Rolle aktiv ist
    const activeRole = sessionStorage.getItem('userRole');
    if (activeRole === 'admin') {
        initAdminView();
    } else if (activeRole === 'employee') {
        initEmployeeView();
    } else {
        switchView('login-view');
    }

    // --- Login-Logik ---
    document.getElementById('admin-login-btn').addEventListener('click', () => {
        const password = document.getElementById('password').value;
        if (password === ADMIN_PASSWORD) {
            sessionStorage.setItem('userRole', 'admin');
            initAdminView();
        } else {
            alert('Falsches Passwort!');
        }
    });

    document.getElementById('employee-login-btn').addEventListener('click', () => {
        sessionStorage.setItem('userRole', 'employee');
        initEmployeeView();
    });

    // --- Logout-Logik ---
    document.getElementById('logout-btn').addEventListener('click', () => {
        sessionStorage.removeItem('userRole');
        switchView('login-view');
    });

    // --- ADMIN FUNKTIONEN ---
    function initAdminView() {
        switchView('admin-view');
        const productGrid = document.getElementById('product-grid');
        productGrid.innerHTML = ''; // Leeren, um Duplikate zu vermeiden
        let selectedProductIds = new Set();

        products.forEach(product => {
            const card = document.createElement('div');
            card.className = 'product-card';
            card.dataset.id = product.id;
            card.innerHTML = `<h3>${product.name}</h3><p>${product.category}</p>`;
            card.addEventListener('click', () => {
                card.classList.toggle('selected');
                const productId = parseInt(card.dataset.id);
                selectedProductIds.has(productId) ? selectedProductIds.delete(productId) : selectedProductIds.add(productId);
            });
            productGrid.appendChild(card);
        });

        document.getElementById('booking-form').addEventListener('submit', (event) => {
            event.preventDefault();
            if (selectedProductIds.size === 0) {
                alert('Bitte wählen Sie mindestens ein Produkt aus.');
                return;
            }
            const selectedProducts = products.filter(p => selectedProductIds.has(p.id));

            const bookingData = {
                buchungsId: 'B' + Date.now(),
                kunde: document.getElementById('customerName').value,
                telefon: document.getElementById('customerPhone').value,
                adresse: document.getElementById('deliveryAddress').value,
                lieferdatum: document.getElementById('deliveryDate').value,
                lieferzeit: document.getElementById('deliveryTime').value,
                anmerkungen: document.getElementById('notes').value,
                produkte: selectedProducts.map(p => p.name)
            };

            // Speichern im Local Storage für die Mitarbeiter-Ansicht
            let bookings = JSON.parse(localStorage.getItem('partycrasherBookings')) || [];
            bookings.push(bookingData);
            localStorage.setItem('partycrasherBookings', JSON.stringify(bookings));

            alert(`Buchung ${bookingData.buchungsId} wurde für Mitarbeiter gespeichert!`);

            // Optional: WhatsApp Link generieren
            const jsonString = JSON.stringify(bookingData, null, 2);
            const whatsappMessage = `*Neue Buchung - ${bookingData.buchungsId}*\n\`\`\`\n${jsonString}\n\`\`\``;
            document.getElementById('whatsapp-link').href = `https://wa.me/?text=${encodeURIComponent(whatsappMessage)}`;
            document.getElementById('whatsapp-link-container').style.display = 'block';

            // Formular zurücksetzen
            event.target.reset();
            document.querySelectorAll('.product-card.selected').forEach(card => card.classList.remove('selected'));
            selectedProductIds.clear();
        });
    }

    // --- MITARBEITER FUNKTIONEN ---
    function initEmployeeView() {
        switchView('employee-view');
        renderEmployeeBookings();
    }
    
    function renderEmployeeBookings() {
        const bookingsList = document.getElementById('bookings-list');
        const bookings = JSON.parse(localStorage.getItem('partycrasherBookings')) || [];
        bookingsList.innerHTML = '';

        if (bookings.length === 0) {
            bookingsList.innerHTML = '<p>Keine offenen Aufträge.</p>';
            return;
        }

        bookings.sort((a, b) => new Date(a.lieferdatum) - new Date(b.lieferdatum));

        bookings.forEach(booking => {
            const item = document.createElement('div');
            item.className = 'card booking-list-item';
            const productList = booking.produkte.map(p => `<li>${p}</li>`).join('');

            item.innerHTML = `
                <div class="booking-header">
                    <h3>${booking.kunde} - ${new Date(booking.lieferdatum).toLocaleDateString('de-DE')}</h3>
                    <button class="btn btn-delete" data-id="${booking.buchungsId}">Erledigt</button>
                </div>
                <p><strong>Datum & Uhrzeit:</strong> ${new Date(booking.lieferdatum).toLocaleDateString('de-DE', {weekday: 'long', day: 'numeric', month: 'long'})} um ${booking.lieferzeit} Uhr</p>
                <p><strong>Adresse:</strong> ${booking.adresse.replace(/\n/g, '<br>')}</p>
                <p><strong>Telefon:</strong> <a href="tel:${booking.telefon}">${booking.telefon}</a></p>
                <h4>Produkte:</h4>
                <ul>${productList}</ul>
                ${booking.anmerkungen ? `<p><strong>Anmerkungen:</strong> ${booking.anmerkungen}</p>` : ''}
            `;
            bookingsList.appendChild(item);
        });

        // Event Listener für "Erledigt"-Buttons
        document.querySelectorAll('.btn-delete').forEach(button => {
            button.addEventListener('click', (e) => {
                const bookingIdToDelete = e.target.dataset.id;
                if (confirm(`Möchten Sie den Auftrag für "${bookingIdToDelete}" als erledigt markieren und aus der Liste entfernen?`)) {
                    let currentBookings = JSON.parse(localStorage.getItem('partycrasherBookings')) || [];
                    const updatedBookings = currentBookings.filter(b => b.buchungsId !== bookingIdToDelete);
                    localStorage.setItem('partycrasherBookings', JSON.stringify(updatedBookings));
                    renderEmployeeBookings(); // Liste neu zeichnen
                }
            });
        });
    }
});
</script>

</body>
</html>
